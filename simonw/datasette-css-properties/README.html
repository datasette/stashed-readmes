<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">datasette-css-properties</h1><a id="user-content-datasette-css-properties" class="anchor" aria-label="Permalink: datasette-css-properties" href="#datasette-css-properties"><svg class="octicon octicon-link" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="https://pypi.org/project/datasette-css-properties/" rel="nofollow"><img src="https://img.shields.io/pypi/v/datasette-css-properties.svg" alt="PyPI" style="max-width: 100%;" data-camo-src="https://camo.githubusercontent.com/b42a03ffea99ea61a949ccacf8264e43b6e8fa1a6de7cbaa98c1278ea40778af/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f6461746173657474652d6373732d70726f706572746965732e737667"></a>
<a href="https://github.com/simonw/datasette-css-properties/releases"><img src="https://img.shields.io/github/v/release/simonw/datasette-css-properties?include_prereleases&label=changelog" alt="Changelog" style="max-width: 100%;" data-camo-src="https://camo.githubusercontent.com/794fbfc0b73c14c55aa8b1c4ad837d32436b724edbf97c6ba21103f256c8f19b/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f762f72656c656173652f73696d6f6e772f6461746173657474652d6373732d70726f706572746965733f696e636c7564655f70726572656c6561736573266c6162656c3d6368616e67656c6f67"></a>
<a href="https://github.com/simonw/datasette-css-properties/actions?query=workflow%3ATest"><img src="https://github.com/simonw/datasette-css-properties/workflows/Test/badge.svg" alt="Tests" style="max-width: 100%;"></a>
<a href="https://github.com/simonw/datasette-css-properties/blob/main/LICENSE"><img src="https://img.shields.io/badge/license-Apache%202.0-blue.svg" alt="License" style="max-width: 100%;" data-camo-src="https://camo.githubusercontent.com/c355f200ea90fddaa407b6eaab303663a669248ea3ca7b1fcf77dbe04ff5f48c/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d417061636865253230322e302d626c75652e737667"></a></p>
<p dir="auto">Extremely experimental Datasette output plugin using CSS properties, inspired by <a href="https://css-tricks.com/custom-properties-as-state/" rel="nofollow">Custom Properties as State</a> by Chris Coyier.</p>
<p dir="auto">More about this project: <a href="https://simonwillison.net/2021/Jan/7/css-apis-no-javascript/" rel="nofollow">APIs from CSS without JavaScript: the datasette-css-properties plugin</a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Installation</h2><a id="user-content-installation" class="anchor" aria-label="Permalink: Installation" href="#installation"><svg class="octicon octicon-link" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Install this plugin in the same environment as Datasette.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="$ datasette install datasette-css-properties"><pre class="notranslate"><code>$ datasette install datasette-css-properties
</code></pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Usage</h2><a id="user-content-usage" class="anchor" aria-label="Permalink: Usage" href="#usage"><svg class="octicon octicon-link" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Once installed, this plugin adds a <code>.css</code> output format to every query result. This will return the first row in the query as a valid CSS file, defining each column as a custom property:</p>
<p dir="auto">Example: <a href="https://latest-with-plugins.datasette.io/fixtures/roadside_attractions.css" rel="nofollow">https://latest-with-plugins.datasette.io/fixtures/roadside_attractions.css</a> produces:</p>
<div class="highlight highlight-source-css notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content=":root {
  --pk: '1';
  --name: 'The Mystery Spot';
  --address: '465 Mystery Spot Road, Santa Cruz, CA 95065';
  --latitude: '37.0167';
  --longitude: '-122.0024';
}"><pre><span class="pl-kos">:</span><span class="pl-c1">root</span> {
  <span class="pl-s1">--pk</span><span class="pl-kos">:</span> <span class="pl-s">'1'</span>;
  <span class="pl-s1">--name</span><span class="pl-kos">:</span> <span class="pl-s">'The Mystery Spot'</span>;
  <span class="pl-s1">--address</span><span class="pl-kos">:</span> <span class="pl-s">'465 Mystery Spot Road, Santa Cruz, CA 95065'</span>;
  <span class="pl-s1">--latitude</span><span class="pl-kos">:</span> <span class="pl-s">'37.0167'</span>;
  <span class="pl-s1">--longitude</span><span class="pl-kos">:</span> <span class="pl-s">'-122.0024'</span>;
}</pre></div>
<p dir="auto">If you link this stylesheet to your page you can then do things like this;</p>
<div class="highlight highlight-text-html-basic notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="<link rel="stylesheet" href="https://latest-with-plugins.datasette.io/fixtures/roadside_attractions.css">
<style>
.attraction-name:after { content: var(--name); }
</style>
<p class="attraction-name">Attraction name: </p>"><pre><span class="pl-kos"><</span><span class="pl-ent">link</span> <span class="pl-c1">rel</span>="<span class="pl-s">stylesheet</span>" <span class="pl-c1">href</span>="<span class="pl-s">https://latest-with-plugins.datasette.io/fixtures/roadside_attractions.css</span>"<span class="pl-kos">></span>
<span class="pl-kos"><</span><span class="pl-ent">style</span><span class="pl-kos">></span>
.<span class="pl-c1">attraction-name</span><span class="pl-kos">:</span><span class="pl-c1">after</span> { <span class="pl-c1">content</span><span class="pl-kos">:</span> <span class="pl-en">var</span>(<span class="pl-s1">--name</span>); }
<span class="pl-kos"></</span><span class="pl-ent">style</span><span class="pl-kos">></span>
<span class="pl-kos"><</span><span class="pl-ent">p</span> <span class="pl-c1">class</span>="<span class="pl-s">attraction-name</span>"<span class="pl-kos">></span>Attraction name: <span class="pl-kos"></</span><span class="pl-ent">p</span><span class="pl-kos">></span></pre></div>
<p dir="auto">Values will be quoted as CSS strings by default. If you want to return a "raw" value without the quotes - for example to set a CSS property that is numeric or a color, you can specify that column name using the <code>?_raw=column-name</code> parameter. This can be passed multiple times.</p>
<p dir="auto">Consider <a href="https://latest-with-plugins.datasette.io/github?sql=select%0D%0A++%27%23%27+%7C%7C+substr(sha%2C+0%2C+6)+as+%5Bcustom-bg%5D%0D%0Afrom%0D%0A++commits%0D%0Aorder+by%0D%0A++author_date+desc%0D%0Alimit%0D%0A++1%3B" rel="nofollow">this example query</a>:</p>
<div class="highlight highlight-source-sql notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="select
  '#' || substr(sha, 0, 6) as [custom-bg]
from
  commits
order by
  author_date desc
limit
  1;"><pre><span class="pl-k">select</span>
  <span class="pl-s"><span class="pl-pds">'</span>#<span class="pl-pds">'</span></span> <span class="pl-k">||</span> substr(sha, <span class="pl-c1">0</span>, <span class="pl-c1">6</span>) <span class="pl-k">as</span> [custom<span class="pl-k">-</span>bg]
<span class="pl-k">from</span>
  commits
<span class="pl-k">order by</span>
  author_date <span class="pl-k">desc</span>
<span class="pl-k">limit</span>
  <span class="pl-c1">1</span>;</pre></div>
<p dir="auto">This returns the first 6 characters of the most recently authored commit with a <code>#</code> prefix. The <code>.css</code> <a href="https://latest-with-plugins.datasette.io/github.css?sql=select%0D%0A++%27%23%27+%7C%7C+substr(sha%2C+0%2C+6)+as+%5Bcustom-bg%5D%0D%0Afrom%0D%0A++commits%0D%0Aorder+by%0D%0A++author_date+desc%0D%0Alimit%0D%0A++1%3B" rel="nofollow">output rendered version</a> looks like this:</p>
<div class="highlight highlight-source-css notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content=":root {
  --custom-bg: '#97fb1';
}"><pre><span class="pl-kos">:</span><span class="pl-c1">root</span> {
  <span class="pl-s1">--custom-bg</span><span class="pl-kos">:</span> <span class="pl-s">'#97fb1'</span>;
}</pre></div>
<p dir="auto">Adding <code>?_raw=custom-bg</code> to the URL produces <a href="https://latest-with-plugins.datasette.io/github.css?sql=select%0D%0A++%27%23%27+%7C%7C+substr(sha%2C+0%2C+6)+as+%5Bcustom-bg%5D%0D%0Afrom%0D%0A++commits%0D%0Aorder+by%0D%0A++author_date+desc%0D%0Alimit%0D%0A++1%3B&_raw=custom-bg" rel="nofollow">this instead</a>:</p>
<div class="highlight highlight-source-css notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content=":root {
  --custom-bg: #97fb1;
}"><pre><span class="pl-kos">:</span><span class="pl-c1">root</span> {
  <span class="pl-s1">--custom-bg</span><span class="pl-kos">:</span> <span class="pl-pds"><span class="pl-kos">#</span>97fb1</span>;
}</pre></div>
<p dir="auto">This can then be used as a color value like so:</p>
<div class="highlight highlight-source-css notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="h1 {
    background-color: var(--custom-bg);
}"><pre><span class="pl-ent">h1</span> {
    <span class="pl-c1">background-color</span><span class="pl-kos">:</span> <span class="pl-en">var</span>(<span class="pl-s1">--custom-bg</span>);
}</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Development</h2><a id="user-content-development" class="anchor" aria-label="Permalink: Development" href="#development"><svg class="octicon octicon-link" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To set up this plugin locally, first checkout the code. Then create a new virtual environment:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="cd datasette-css-properties
python3 -mvenv venv
source venv/bin/activate"><pre class="notranslate"><code>cd datasette-css-properties
python3 -mvenv venv
source venv/bin/activate
</code></pre></div>
<p dir="auto">Or if you are using <code>pipenv</code>:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="pipenv shell"><pre class="notranslate"><code>pipenv shell
</code></pre></div>
<p dir="auto">Now install the dependencies and tests:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="pip install -e '.[test]'"><pre class="notranslate"><code>pip install -e '.[test]'
</code></pre></div>
<p dir="auto">To run the tests:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="pytest"><pre class="notranslate"><code>pytest
</code></pre></div>
</article></div>